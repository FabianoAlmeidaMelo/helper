{% extends "base.html" %}
{% load bootstrap3 %}

{% block page_title %}
  <div class="page-header">
  <!-- TODO erver esse br -->
    <br>
    {% if agenda %}
      {{ agenda.nome }}
    {% else %}
      Tarefas
    {% endif %}
    <h5>{{ data_ini|date:"d/m/Y" }} a {{ data_fim|date:"d/m/Y" }}</h5> 
  </div>
{% endblock page_title %}

{% block content %}
<form class="form-inline well" method="GET" action="#">
  <div class="form-group">
      {% bootstrap_field form.titulo %}
      {% bootstrap_field form.servico %}
      {% bootstrap_field form.descricao %}
      {% bootstrap_field form.data_ini %}
      {% bootstrap_field form.data_fim %}
    </div>
    <br>

  <legend style="font-size:12px;">
     <a href="#" class="panel-showhide"><i class="icon-plus-sign"></i>Opções de Filtro</a></legend>
      <div class="panel-showhide">
        <div class="form-group">
          {% bootstrap_field form.confirmado %}
          {% bootstrap_field form.pago %}
          {{ form.not_pago.label }} {{ form.not_pago }}
          {% bootstrap_field form.tipo %}
          {% bootstrap_field form.valor %}
        </div>
      </div>

    <button type="submit" class="btn btn-primary" title="Filtrar"><i class="glyphicon glyphicon-search"></i></button>
    {% if agenda %}
      <a class="btn btn-small btn-info" href="{% url 'agenda_tarefa_list' conta.id  agenda.id%}" title="Apaga o filtro e listar todos"><i class="glyphicon glyphicon-remove-circle"></i></a>
    {% else %}
      <a class="btn btn-small btn-info" href="{% url 'tarefa_list' conta.id %}" title="Apaga o filtro e listar todos"><i class="glyphicon glyphicon-remove-circle"></i></a>
    {% endif %}
    {% if agenda %}
      <a class="btn btn-success" href="{% url 'agenda_tarefa_add' conta.id agenda.id %}">Nova Tarefa</a>
    {% else %}
      <a class="btn btn-success" href="{% url 'tarefa_add' conta.id %}">Nova Tarefa</a>
    {% endif %}

</form>

<div class="row-fluid">

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Titulo</th>
        {% if not agenda %}
          <th>Agenda</th>
        {% endif %}
        <th>Serviço</th>
        <th>Nr Doc.</th>
        <th>Data</th>
        <th>Hora</th>
        <th>Valor</th>
        <th>Confirmado</th>
        <th>Pago</th>
      </tr>
    </thead>
    {% for object in object_list %}
    <tr class="{{ object.get_context_alert }}">
      <td>
        {% if agenda %}
          <a href="{% url 'agenda_tarefa_edit' conta.id agenda.id object.pk %}">{{ object.titulo }}</a>
        {% else %}
          <a href="{% url 'tarefa_edit' conta.id object.pk %}">{{ object.titulo }}</a>
        {% endif %}
      </td>
      {% if not agenda %}
        <td>{{ object.servico.agenda|default:"--" }}</td>
      {% endif %}
        <td>{{ object.servico.nome|default:'--' }}</td>
        <td>{{ object.nr_documento|default:'--' }}</td>
        <td>{{ object.data_ini|date:"d/m/Y" }}</td>
        <td>{{ object.hora_ini }}</td>
        <td>{{ object.get_tipo_display|default:"" }} $ {{ object.valor|default:'--'  }}</td>
        <td>{{ object.confirmado|yesno:"Sim,Não" }}</td>
        <td>
          {% if object.pago %}
            <a href="{% url 'set_tarefa_status' conta.pk object.pk %}">
              <button type="button" class="btn btn-success" name="button_unset_pago" id="btn_unset_pago_{{ object.pk}}">
                <i class="glyphicon glyphicon-ok icon-white"></i>
              </button>
              <button type="button"
                          class="btn btn-success"
                          name="button_unset_pago"
                          id="btn_unset_pago_{{ object.pk}}"
                          onclick="unset_tarefa_status(this)"> 
                    <i class="glyphicon glyphicon-ok icon-white"></i>
                  </button>
            </a>
          {% else %}
            <a href="{% url 'set_tarefa_status' conta.pk object.pk %}">
              <button type="button" class="btn btn-danger"  name="button_set_pago" id="btn_set_pago_{{ object.pk}}">
                <i class="glyphicon glyphicon-star-empty"></i>
              </button>
            </a>
          {% endif %}
        </td>
    </tr>
    {% empty %}
      <tr><td colspan="100%">Nenhuma tarefa no período</td></tr>
    {% endfor %}
  </table>
  <tfoot>
  </tfoot>
</div>

 {% bootstrap_pagination page_obj extra=request.GET.urlencode %}

{% endblock content %}
{% block extra_js %}
  {{ form.media.js}}
  <script type="text/javascript">
    jQuery(document).ready( function() {
        /*
        Show / Hide qualquer div com a class="panel-showhide"
        O objeto que recebe a funcao para show/hide deve ser um LINK com a mesma classe.
        Ambos devem estar dentro de um container (fieldset, div ...)
        */
        jQuery('div.panel-showhide').hide();
        jQuery('a.panel-showhide').click( function() {
            jQuery(this).parent().parent().find('div.panel-showhide').toggle();
        });

        $('td a.enviar').not('.disabled').click(function (){
            var pedido_pk = $(this).data('pedido');
            $('#id_pedido_pk').val(pedido_pk);
            $('#ModalEnviar').modal('show');
        });
    });
  
  function set_tarefa_status(field)
  {
      if($(field).is(':checked'))
      {
        $(field).attr('disabled', 'true');
        $(field).attr('checked', 'checked');
        
        $.get("#", function(data){
         
        });
        ajax_init_list('projeto-projetopagamentogestao');
        $('#btn_desvalida').html('<button onclick="unset_pago(this)">Desvalidar</div>');
        $('#projeto-projetopagamentogestao-bt').hide();          
      }      
  }
  
  function unset_tarefa_status(field){
      if($('#pago').is(':checked')){
        $("#pago").attr('disabled', false);
        $("#pago").attr('checked', false);
        $.get("#");
        $('#btn_desvalida').html('');
        ajax_init_list('projeto-projetopagamentogestao'); 
        $('#projeto-projetopagamentogestao-bt').show();          
      }      
  }

    </script>


{% endblock extra_js %}
